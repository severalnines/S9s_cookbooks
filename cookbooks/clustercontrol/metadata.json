{
  "name": "clustercontrol",
  "description": "Installs/Configures Severalnines Clustercontrol",
  "long_description": "clustercontrol Cookbook\n=======================\nInstalls ClusterControl on your existing database cluster. ClusterControl is an agentless management and automation software for database clusters. It helps deploy, monitor, manager and scale your database cluster. This cookbook will install ClusterControl and configure it to manage and monitor an **existing** database cluster.\n\nSupported database clusters:\n\n- Galera Cluster for MySQL\n- Percona XtraDB Cluster\n- MariaDB Galera Cluster\n- MySQL Replication\n- MySQL Cluster\n- MongoDB Replica Set\n- MongoDB Sharded Cluster\n- TokuMX Cluster\n\nMore details at [Severalnines](http://www.severalnines.com/clustercontrol) website.\n\nThis cookbook is a replacement for deprecated [cmon](https://supermarket.chef.io/cookbooks/cmon) cookbook that we have built earlier. It manages and configures ClusterControl and all of its components:\n\n- Install ClusterControl controller, cmonapi and UI via Severalnines package repository.\n- Install and configure MySQL, create CMON DB, grant cmon user and configure DB for ClusterControl UI.\n- Install and configure Apache, check permission and install SSL.\n- Copy the generated SSH key to all nodes.\n\nIf you have any questions, you are welcome to get in touch via our [contact us](http://www.severalnines.com/contact-us) page or email us at [info@severalnines.com](mailto:info@severalnines.com).\n\n\nRequirements\n------------\n\n### Platform\n\n- CentOS, Redhat, Fedora\n- Debian, Ubuntu\n- x86_64 architecture only\n\nTested on Chef Server 11.1/12.0 on following platforms:\n\n- CentOS 6.5 64bit\n- Ubuntu 12.04 64bit\n- Ubuntu 14.04 64bit\n- Debian 7 64bit\n\nMake sure you meet following criteria prior to the deployment:\n\n- ClusterControl node must run on a clean dedicated host with internet connection.\n- ClusterControl node must run on the same operating system distribution with your database hosts (mixing Debian with Ubuntu or CentOS with Red Hat is possible)\n- Make sure your database cluster is up and running.\n- If you are running as sudo user, make sure the user is able to escalate to root with sudo command.\n- SELinux/AppArmor must be turned off. Services or ports to be enabled are listed [here](http://www.severalnines.com/docs/clustercontrol-administration-guide/administration/securing-clustercontrol).\n\n\nAttributes\n----------\n\nPlease refer to `attributes/default.rb`\n\nData Bags\n---------\n\nData items are used by the ClusterControl controller recipe to configure SSH public key on database hosts, grants cmon database user and setting up CMON configuration file. We provide a helper script located under `clustercontrol/files/default/s9s_helper.sh`. Please run this script prior to the deployment.\n\n### Helper script - s9s_helper.sh\n```bash\n$ cd ~/chef-repo/cookbooks/clustercontrol/files/default\n$ ./s9s_helper.sh\n```\n\nAnswer all the questions and at the end of the wizard, it will generate a data bag file called `config.json` and a set of command that you can use to create and upload the data bag. If you run the script for the first time, it will ask to re-upload the cookbook since it contains a newly generated SSH key:\n```bash\n$ knife cookbook upload clustercontrol\n```\n\n### Example data bag - clustercontrol/files/default/config.json\n```json\n{\n  \"id\"                      : \"config\",\n  \"cluster_type\"            : \"galera\",\n  \"email_address\"           : \"admin@localhost.xyz\",\n  \"ssh_user\"                : \"ubuntu\",\n  \"cmon_password\"           : \"cmonP4ss\",\n  \"mysql_root_password\"     : \"myR00tP4ssword\",\n  \"mysql_server_addresses\"  : \"192.168.1.11,192.168.1.12,192.168.1.13\",\n  \"clustercontrol_host\"     : \"192.168.1.10\",\n  \"clustercontrol_api_token\": \"b7e515255db703c659677a66c4a17952515dbaf5\"\n}\n```\n\n*We highly recommend you to use encrypted data bag since it contains confidential information*\n\n### ClusterControl general options\n\nFollowing options are used for the general ClusterControl set up:\n\n`id`\nThe data item identifier. Do not change this value.\n\n`cluster_type`\nThe database cluster type. MySQL replication falls under mysql_single. Supported values: galera, mysqlcluster, replication, mysql_single, mongodb\n- Default: 'galera'\n\n`email_address`\nSpecify an email as root user for ClusterControl UI. You will login using this email with default password 'admin'.\n- Default: 'admin@localhost.xyz'\n\n`ssh_user`\nSpecify the SSH user that ClusterControl will use to manage the database nodes. Unless root, make sure this user is in sudoers list. \n- Default: 'root'\n\n`ssh_port`\nSpecify the SSH port used by ClusterControl to SSH into database hosts. All nodes in the cluster must use the same SSH port.\n- Default: 22\n\n`cmon_password`\nSpecify the MySQL password for user cmon. The recipe will grant this user with specified password, and is needed by ClusterControl.\n-Default: 'cmon'\n\n`clustercontrol_host`\nThe ClusterControl host IP address\n- Example: '11.22.33.44'\n\n`clustercontrol_api_token`\n40-character ClusterControl token generated from s9s_helper script. \n- Example: 'b7e515255db703c659677a66c4a17952515dbaf5'\n\n`datadir`\nPath to the database cluster's data directory that ClusterControl should monitor\n- Default: `/var/lib/mysql`\n\n### MySQL specific options\n\nFollowing options are used for supported MySQL-based cluster type particularly MySQL standalone, Galera Cluster, MySQL Replication or MySQL Cluster.\n\n`mysql_server_addresses`\nComma-separated list of MySQL servers' IP address that ClusterControl should monitor. For MySQL cluster, specify the MySQL API nodes list instead. \n- Example: '12.12.12.12,13.13.13.13,14.14.14.14'\n\n`vendor`\nDatabase cluster provider (Galera Clusters only). Supported values: percona, mariadb or codership. \n- Default: 'percona'\n\n`mysql_root_password`\nMySQL root password of your database cluster to be monitored by ClusterControl.\n- Default: 'password'\n\n`datanode_addresses`\nComma-separated list of MySQL data nodes' IP address that ClusterControl should monitor (MySQL Cluster only).\n- Example: '12.12.12.12,13.13.13.13,14.14.14.14'\n\n`mgmnode_addresses`\nComma-separated list of MySQL data nodes' IP address that ClusterControl should monitor (MySQL Cluster only).\n- Example: '12.12.12.12,13.13.13.13,14.14.14.14'\n\n### MongoDB specific options\nFollowing options are used for supported MongoDB and TokuMX cluster type particularly Sharded Cluster or Replica Set.\n\n`mongodb_server_addresses`\nComma-separated list of IP address/hostname with port of MongoDB/TokuMX shard/replica set nodes that ClusterControl should monitor.\n- Example: '12.12.12.12:27017,13.13.13.13:27017'\n\n`mongoarbiter_server_addresses`\nComma-separated list of IP address/hostname with port of MongoDB/TokuMX arbiter node (if any) that ClusterControl should monitor.\n- Example: '12.12.12.12:30000,13.13.13.13:30000'\n\n`mongocfg_server_addresses`\nComma-separated list of IP address/hostname with port of MongoDB/TokuMX config node (sharded cluster only) that ClusterControl should monitor.\n- Example: '12.12.12.12:27019,13.13.13.13:27019'\n\n`mongos_server_addresses`\nComma-separated list of IP address/hostname with port of MongoDB/TokuMX mongos node (sharded cluster only) that ClusterControl should monitor.\n- Example: '12.12.12.12:27017,13.13.13.13:27017'\n\n\nUsage\n-----\n#### clustercontrol::default, clustercontrol::controller\n\nFor ClusterControl host, just include `clustercontrol` or `clustercontrol::controller` in your node's `run_list`:\n\n```json\n{\n  \"name\":\"clustercontrol_node\",\n  \"run_list\": [\n    \"recipe[clustercontrol]\"\n  ]\n}\n```\n\n### clustercontrol::db_hosts\n\nFor database hosts, include `clustercontrol::db_hosts` in your node's `run_list`:\n\n```json\n{\n  \"name\":\"database_nodes\",\n  \"run_list\": [\n    \"recipe[clustercontrol::db_hosts]\"\n  ]\n}\n```\n\n** Do not forget to generate databag before the deployment begins! Once the cookbook is applied to all nodes, open ClusterControl web UI at `https://[ClusterControl IP address]/clustercontrol` and login using specified email address with default password 'admin'.\n\nLimitations\n-----------\n\nThis module has been tested on following platforms:\n\n- Debian 7 (wheezy)\n- Ubuntu 14.04 LTS (trusty)\n- Ubuntu 12.04 LTS (precise)\n- RHEL 5/6\n- CentOS 5/6\n\nThis module only supports bootstrapping MySQL servers with IP address only (it expects skip-name-resolve is enabled on all MySQL nodes). However, for MongoDB you can specify hostname as described under MongoDB Specific Options.\n\n[ClusterControl known issues and limitations](http://www.severalnines.com/docs/clustercontrol-troubleshooting-guide/known-issues-limitations).\n\nChange History\n--------------\n\n- v0.1.3 - Add datadir into s9s_helper\n- v0.1.2 - Fixed sudoer with password\n- v0.1.1 - Cleaning up and updated README\n- v0.1.0 - Initial recipes based on ClusterControl v1.2.8\n\nLicense and Authors\n-------------------\nAshraf Sharif (ashraf@severalnines.com) Derived from Opscode, Inc cookbook recipes examples.\n\nCopyright (c) 2014 Severalnines AB.\n\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License. You may obtain a copy of the License at\n\n`http://www.apache.org/licenses/LICENSE-2.0`\n\nUnless required by applicable law or agreed to in writing, software distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.\n\nPlease report bugs or suggestions via our support channel: [https://support.severalnines.com](https://support.severalnines.com)\n",
  "maintainer": "Severalnines AB",
  "maintainer_email": "ashraf@severalnines.com",
  "license": "All rights reserved",
  "platforms": {

  },
  "dependencies": {

  },
  "recommendations": {

  },
  "suggestions": {

  },
  "conflicting": {

  },
  "providing": {

  },
  "replacing": {

  },
  "attributes": {

  },
  "groupings": {

  },
  "recipes": {

  },
  "version": "0.1.4",
  "source_url": "",
  "issues_url": ""
}
